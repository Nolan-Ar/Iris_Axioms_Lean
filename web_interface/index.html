<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IRIS Economic Simulator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            padding: 30px;
        }

        .controls {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            height: fit-content;
        }

        .controls h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .slider-group {
            margin-bottom: 25px;
        }

        .slider-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .slider-group input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider-value {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            color: #667eea;
            font-size: 1.1em;
        }

        .btn-simulate {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 10px;
        }

        .btn-simulate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-simulate:active {
            transform: translateY(0);
        }

        .results {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        canvas {
            max-height: 400px !important;
        }

        #axiomStatus {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        #axiomStatus h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        #axiomStatus ul {
            list-style: none;
            padding-left: 0;
        }

        #axiomStatus li {
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            border-radius: 5px;
            transition: transform 0.2s;
        }

        #axiomStatus li:hover {
            transform: translateX(5px);
        }

        .explanations {
            grid-column: 1 / -1;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-top: 10px;
        }

        .explanations h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .concepts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .concept {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .concept:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .concept strong {
            color: #667eea;
            font-size: 1.2em;
            display: block;
            margin-bottom: 10px;
        }

        .concept p {
            color: #666;
            line-height: 1.6;
        }

        .thermometer-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .thermometer-value {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .zone-cold { color: #007bff; }
        .zone-equilibrium { color: #28a745; }
        .zone-hot { color: #dc3545; }

        .zone-label {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 10px;
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>IRIS Economic Simulator</h1>
            <p>Simulateur interactif du syst√®me thermodynamique √©conomique IRIS</p>
        </header>

        <div class="main-content">
            <div class="controls">
                <h2>Param√®tres √©conomiques</h2>

                <div class="slider-group">
                    <label for="D_total">
                        D_total (Dette totale):
                        <span class="slider-value" id="D_totalValue">120000</span>
                    </label>
                    <input type="range" id="D_total" min="50000" max="300000" step="1000" value="120000">
                </div>

                <div class="slider-group">
                    <label for="V_on_total">
                        V_on_total (Valeur circulante):
                        <span class="slider-value" id="V_on_totalValue">100000</span>
                    </label>
                    <input type="range" id="V_on_total" min="50000" max="300000" step="1000" value="100000">
                </div>

                <div class="slider-group">
                    <label for="eta">
                        Œ∑ (Coefficient de cr√©ation):
                        <span class="slider-value" id="etaValue">1.20</span>
                    </label>
                    <input type="range" id="eta" min="0.5" max="2.0" step="0.05" value="1.2">
                </div>

                <div class="slider-group">
                    <label for="kappa">
                        Œ∫ (Conversion U‚ÜíV):
                        <span class="slider-value" id="kappaValue">0.80</span>
                    </label>
                    <input type="range" id="kappa" min="0.5" max="2.0" step="0.05" value="0.8">
                </div>

                <div class="slider-group">
                    <label for="delta_D">
                        Œ¥_D (Amortissement D par cycle):
                        <span class="slider-value" id="delta_DValue">0.1042%</span>
                    </label>
                    <input type="range" id="delta_D" min="0" max="0.005" step="0.0001" value="0.001041666">
                </div>

                <div class="slider-group">
                    <label for="adjustment_rate">
                        Taux d'ajustement (Œ∑, Œ∫):
                        <span class="slider-value" id="adjustment_rateValue">5.0%</span>
                    </label>
                    <input type="range" id="adjustment_rate" min="0.01" max="0.15" step="0.01" value="0.05">
                </div>

                <button class="btn-simulate" onclick="simulate()">Lancer la simulation</button>
            </div>

            <div class="results">
                <div class="thermometer-display">
                    <div style="font-size: 1.2em; color: #666;">Thermom√®tre √©conomique</div>
                    <div class="thermometer-value" id="thermometerValue">1.20</div>
                    <div class="zone-label" id="zoneLabel">√âQUILIBRE</div>
                    <div style="margin-top: 10px; color: #666;" id="recommendation"></div>
                </div>

                <div style="background: #fff9e6; padding: 15px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #f59e0b;">
                    <h4 style="margin: 0 0 10px 0; color: #f59e0b;">‚öôÔ∏è Param√®tres de r√©gulation</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.95em;">
                        <div>
                            <strong>Œ∑ (actuel):</strong> <span id="eta_display">1.20</span>
                            <div style="font-size: 0.85em; color: #666;">Coefficient de cr√©ation [0.5, 2.0]</div>
                        </div>
                        <div>
                            <strong>Œ∫ (actuel):</strong> <span id="kappa_display">0.80</span>
                            <div style="font-size: 0.85em; color: #666;">Conversion U‚ÜíV [0.5, 2.0]</div>
                        </div>
                        <div style="grid-column: 1 / -1;">
                            <strong>Œ¥_D (amortissement):</strong> <span id="delta_D_display">0.1042%</span> par cycle
                            <div style="font-size: 0.85em; color: #666;">Dissipation mensuelle du passif thermom√©trique</div>
                        </div>
                    </div>
                    <div style="margin-top: 12px; padding: 10px; background: #f0f7ff; border-radius: 5px; font-size: 0.85em;">
                        <strong>Convention de signe :</strong> Dans ce simulateur, D_total (Dette) est affich√© comme valeur positive
                        pour l'intuition. Dans la formalisation Lean, D ‚â§ 0 (dette thermodynamique n√©gative par d√©finition).
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="thermometerChart"></canvas>
                </div>

                <div class="chart-container">
                    <canvas id="coefficientsChart"></canvas>
                </div>

                <div class="chart-container">
                    <canvas id="valuesChart"></canvas>
                </div>

                <div style="background: #fffaf0; padding: 15px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #f59e0b; font-size: 0.9em;">
                    <h4 style="margin: 0 0 10px 0; color: #f59e0b;">üìä √Ä propos de cette simulation</h4>
                    <p style="margin: 5px 0; line-height: 1.6;">
                        Cette simulation illustre les <strong>axiomes A19 et A20</strong> du protocole IRIS sur 50 cycles.
                        √Ä chaque cycle, le syst√®me :
                    </p>
                    <ol style="margin: 5px 0 5px 20px; line-height: 1.6;">
                        <li>Applique l'amortissement mensuel : <code>D ‚Üê D √ó (1 - Œ¥_D)</code></li>
                        <li>Calcule <code>r_t = D_total / V_on_total</code> (thermom√®tre √©conomique)</li>
                        <li>Ajuste automatiquement <code>Œ∑</code> et <code>Œ∫</code> selon les zones (froid/√©quilibre/chaud)</li>
                        <li>Respecte les bornes [0.5, 2.0] et variations max |ŒîŒ∑|, |ŒîŒ∫| ‚â§ 0.15</li>
                        <li>Simule la cr√©ation de valeur : <code>ŒîV = Œ∑ √ó E</code> avec conservation <code>ŒîD = -ŒîV</code></li>
                    </ol>
                    <p style="margin: 5px 0; line-height: 1.6; color: #666;">
                        <strong>Simplifications :</strong> Ce mod√®le n'inclut pas la distribution du RU (A12),
                        ni les contraintes compl√®tes de conservation S+U+V+D=0 (A1).
                        Pour la formalisation math√©matique rigoureuse, consultez les fichiers Lean du projet.
                    </p>
                </div>

                <div id="axiomStatus">
                    <h3>Axiomes illustr√©s (version simplifi√©e)</h3>
                    <ul>
                        <li><strong>A19</strong> : Thermom√®tre √©conomique (r_t = D/V_on)</li>
                        <li><strong>A20</strong> : R√©gulation automatique de Œ∑ et Œ∫</li>
                        <li><strong>Amortissement</strong> : Dissipation mensuelle du passif thermom√©trique D</li>
                    </ul>
                    <p style="margin-top: 15px; font-size: 0.9em; color: #666; font-style: italic;">
                        <strong>Note:</strong> Ce simulateur illustre les axiomes A19 et A20 dans une version simplifi√©e avec amortissement.
                        Pour la formalisation compl√®te incluant A1 (conservation S+U+V+D=0), A12 (distribution RU),
                        et tous les autres axiomes, consultez
                        <a href="../CONCEPTS_FR.md" style="color: #667eea;">CONCEPTS_FR.md</a>
                        et le code Lean du projet.
                    </p>
                </div>
            </div>

            <div class="explanations">
                <h3>Explications des concepts</h3>
                <div class="concepts-grid">
                    <div class="concept">
                        <strong>Thermom√®tre r_t = D/V_on</strong>
                        <p>Mesure la "temp√©rature" √©conomique du syst√®me.</p>
                        <p>‚Ä¢ r_t &lt; 0.85 : FROID (d√©flation)<br>
                           ‚Ä¢ 0.85 ‚â§ r_t ‚â§ 1.15 : √âQUILIBRE<br>
                           ‚Ä¢ r_t &gt; 1.15 : CHAUD (inflation)</p>
                    </div>

                    <div class="concept">
                        <strong>R√©gulation automatique (A20)</strong>
                        <p>Ajustement automatique de Œ∑ et Œ∫ selon le thermom√®tre.</p>
                        <p>Si r_t &gt; 1.15 ‚Üí R√©duire Œ∑ et Œ∫ (moins de cr√©ation)<br>
                           Si r_t &lt; 0.85 ‚Üí Augmenter Œ∑ et Œ∫ (plus de cr√©ation)<br>
                           Bornes : 0.5 ‚â§ Œ∑, Œ∫ ‚â§ 2.0 | Variation max : |Œî| ‚â§ 0.15</p>
                    </div>

                    <div class="concept">
                        <strong>Amortissement Œ¥_D</strong>
                        <p>Dissipation mensuelle du passif thermom√©trique D.</p>
                        <p>√Ä chaque cycle : <code>D ‚Üê D √ó (1 - Œ¥_D)</code><br>
                           Valeur par d√©faut : Œ¥_D = 0.1042% ‚âà horizon 80 ans<br>
                           Simule la "p√©remption" naturelle de la dette thermodynamique.</p>
                    </div>

                    <div class="concept">
                        <strong>Les quatre grandeurs</strong>
                        <p><strong>V</strong> (Verum): Valeur vivante<br>
                           <strong>D</strong> (Dette): Engagement thermique<br>
                           <strong>S</strong> (Stipulat): Preuve d'effort<br>
                           <strong>U</strong> (Unum): Monnaie d'usage</p>
                    </div>

                    <div class="concept">
                        <strong>Conservation S + U + V + D = 0</strong>
                        <p>Premier principe de la thermodynamique appliqu√© √† l'√©conomie.</p>
                        <p>Toute cr√©ation de valeur (V &gt; 0) g√©n√®re une dette √©gale (D &lt; 0 dans Lean, affich√© positif dans l'UI).</p>
                    </div>

                    <div class="concept">
                        <strong>Œ∫ - Conversion U‚ÜíV</strong>
                        <p>Coefficient de conversion de Unum (p√©rissable) vers Verum (durable).</p>
                        <p>Ajust√© automatiquement par le thermom√®tre comme Œ∑.<br>
                           Bornes : 0.5 ‚â§ Œ∫ ‚â§ 2.0</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let thermometerChart = null;
        let coefficientsChart = null;
        let valuesChart = null;

        // Update slider values in real-time
        const sliders = ['D_total', 'V_on_total', 'eta', 'kappa', 'delta_D', 'adjustment_rate'];
        sliders.forEach(id => {
            const slider = document.getElementById(id);
            const valueDisplay = document.getElementById(id + 'Value');
            slider.addEventListener('input', (e) => {
                let displayValue;
                if (id === 'delta_D') {
                    displayValue = (parseFloat(e.target.value) * 100).toFixed(4) + '%';
                } else if (id === 'adjustment_rate') {
                    displayValue = (parseFloat(e.target.value) * 100).toFixed(1) + '%';
                } else if (id.includes('eta') || id.includes('kappa')) {
                    displayValue = parseFloat(e.target.value).toFixed(2);
                } else {
                    displayValue = parseFloat(e.target.value).toFixed(0);
                }
                valueDisplay.textContent = displayValue;
                simulate(); // Auto-update
            });
        });

        function getZoneInfo(r_t) {
            if (r_t < 0.85) {
                return {
                    zone: 'FROID',
                    class: 'zone-cold',
                    recommendation: 'Syst√®me en d√©flation ‚Üí Œ∑ et Œ∫ augmentent automatiquement'
                };
            } else if (r_t <= 1.15) {
                return {
                    zone: '√âQUILIBRE',
                    class: 'zone-equilibrium',
                    recommendation: 'Syst√®me stable ‚Üí Œ∑ et Œ∫ maintenus constants'
                };
            } else {
                return {
                    zone: 'CHAUD',
                    class: 'zone-hot',
                    recommendation: 'Syst√®me en inflation ‚Üí Œ∑ et Œ∫ diminuent automatiquement'
                };
            }
        }

        function clamp(value, min, max) {
            return Math.max(min, Math.min(max, value));
        }

        function simulate() {
            // Get parameter values
            const D_total = parseFloat(document.getElementById('D_total').value);
            const V_on_total = parseFloat(document.getElementById('V_on_total').value);
            const eta_initial = parseFloat(document.getElementById('eta').value);
            const kappa_initial = parseFloat(document.getElementById('kappa').value);
            const delta_D = parseFloat(document.getElementById('delta_D').value);
            const adjustment_rate = parseFloat(document.getElementById('adjustment_rate').value);

            // Calculate initial thermometer
            const r_t = D_total / V_on_total;

            // Update thermometer display
            const zoneInfo = getZoneInfo(r_t);
            document.getElementById('thermometerValue').textContent = r_t.toFixed(2);
            document.getElementById('thermometerValue').className = 'thermometer-value ' + zoneInfo.class;
            document.getElementById('zoneLabel').textContent = zoneInfo.zone;
            document.getElementById('zoneLabel').className = 'zone-label ' + zoneInfo.class;
            document.getElementById('recommendation').textContent = zoneInfo.recommendation;

            // Update parameter display
            document.getElementById('eta_display').textContent = eta_initial.toFixed(2);
            document.getElementById('kappa_display').textContent = kappa_initial.toFixed(2);
            document.getElementById('delta_D_display').textContent = (delta_D * 100).toFixed(4) + '%';

            // Simulate evolution over 50 cycles
            const cycles = 50;
            const history = simulateEvolution(D_total, V_on_total, eta_initial, kappa_initial, delta_D, adjustment_rate, cycles);

            // Update charts
            updateCharts(history);
        }

        function simulateEvolution(D_total, V_on_total, eta, kappa, delta_D, adjustment_rate, cycles) {
            const history = {
                cycles: [0],
                r_t: [D_total / V_on_total],
                eta: [eta],
                kappa: [kappa],
                V_on: [V_on_total],
                D: [D_total],
                V_norm: [1.0],
                D_norm: [1.0]
            };

            let current_D = D_total;
            let current_V = V_on_total;
            let current_eta = eta;
            let current_kappa = kappa;

            const V_initial = V_on_total;
            const D_initial = D_total;

            for (let i = 1; i <= cycles; i++) {
                // 1. Apply debt amortization FIRST
                current_D = current_D * (1 - delta_D);

                // 2. Calculate thermometer
                const r_t = current_D / current_V;

                // 3. Apply A20 automatic adjustment for both Œ∑ and Œ∫
                let delta_eta = 0;
                let delta_kappa = 0;

                if (r_t > 1.15) {
                    // Hot ‚Üí reduce Œ∑ and Œ∫
                    delta_eta = -current_eta * adjustment_rate;
                    delta_kappa = -current_kappa * adjustment_rate;
                } else if (r_t < 0.85) {
                    // Cold ‚Üí increase Œ∑ and Œ∫
                    delta_eta = current_eta * adjustment_rate;
                    delta_kappa = current_kappa * adjustment_rate;
                }
                // Equilibrium ‚Üí no change

                // 4. Apply variation limits: |ŒîŒ∑|, |ŒîŒ∫| ‚â§ 0.15
                delta_eta = clamp(delta_eta, -0.15, 0.15);
                delta_kappa = clamp(delta_kappa, -0.15, 0.15);

                current_eta = current_eta + delta_eta;
                current_kappa = current_kappa + delta_kappa;

                // 5. Apply bounds: 0.5 ‚â§ Œ∑, Œ∫ ‚â§ 2.0
                current_eta = clamp(current_eta, 0.5, 2.0);
                current_kappa = clamp(current_kappa, 0.5, 2.0);

                // 6. Simulate value creation
                const E_per_cycle = 1000;
                const delta_V = current_eta * E_per_cycle;
                const delta_D_creation = -delta_V; // Conservation: D mirrors V

                current_V += delta_V;
                current_D += delta_D_creation;

                history.cycles.push(i);
                history.r_t.push(current_D / current_V);
                history.eta.push(current_eta);
                history.kappa.push(current_kappa);
                history.V_on.push(current_V);
                history.D.push(current_D);
                history.V_norm.push(current_V / V_initial);
                history.D_norm.push(current_D / D_initial);
            }

            return history;
        }

        function updateCharts(history) {
            // Chart 1: Thermometer evolution
            const ctx1 = document.getElementById('thermometerChart').getContext('2d');
            if (thermometerChart) {
                thermometerChart.destroy();
            }

            thermometerChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: history.cycles,
                    datasets: [{
                        label: 'r_t (Thermom√®tre)',
                        data: history.r_t,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '√âvolution du thermom√®tre r_t sur 50 cycles',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: { position: 'top' },
                        annotation: {
                            annotations: {
                                line1: {
                                    type: 'line',
                                    yMin: 0.85,
                                    yMax: 0.85,
                                    borderColor: 'blue',
                                    borderWidth: 2,
                                    borderDash: [6, 6],
                                    label: {
                                        content: 'Seuil froid (0.85)',
                                        enabled: true,
                                        position: 'start'
                                    }
                                },
                                line2: {
                                    type: 'line',
                                    yMin: 1.15,
                                    yMax: 1.15,
                                    borderColor: 'red',
                                    borderWidth: 2,
                                    borderDash: [6, 6],
                                    label: {
                                        content: 'Seuil chaud (1.15)',
                                        enabled: true,
                                        position: 'start'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Cycles' } },
                        y: { title: { display: true, text: 'r_t' } }
                    }
                }
            });

            // Chart 2: Œ∑ and Œ∫ evolution
            const ctx2 = document.getElementById('coefficientsChart').getContext('2d');
            if (coefficientsChart) {
                coefficientsChart.destroy();
            }

            coefficientsChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: history.cycles,
                    datasets: [
                        {
                            label: 'Œ∑ (Coefficient de cr√©ation)',
                            data: history.eta,
                            borderColor: 'rgb(153, 102, 255)',
                            backgroundColor: 'rgba(153, 102, 255, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Œ∫ (Conversion U‚ÜíV)',
                            data: history.kappa,
                            borderColor: 'rgb(255, 159, 64)',
                            backgroundColor: 'rgba(255, 159, 64, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '√âvolution de Œ∑ et Œ∫ (r√©gulation automatique)',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: { position: 'top' }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Cycles' } },
                        y: {
                            title: { display: true, text: 'Coefficients' },
                            min: 0.4,
                            max: 2.1
                        }
                    }
                }
            });

            // Chart 3: V and D normalized evolution
            const ctx3 = document.getElementById('valuesChart').getContext('2d');
            if (valuesChart) {
                valuesChart.destroy();
            }

            valuesChart = new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: history.cycles,
                    datasets: [
                        {
                            label: 'V_on_total (normalis√©)',
                            data: history.V_norm,
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'D_total (normalis√©)',
                            data: history.D_norm,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '√âvolution de V et D (normalis√©s √† 1.0 au d√©part)',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: { position: 'top' }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Cycles' } },
                        y: { title: { display: true, text: 'Valeur normalis√©e' } }
                    }
                }
            });
        }

        // Initial simulation on page load
        simulate();
    </script>
</body>
</html>
